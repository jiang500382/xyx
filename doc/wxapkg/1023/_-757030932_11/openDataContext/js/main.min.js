var e = window.egret, t = function(e, t, a) {
    e.__class__ = t, a ? a.push(t) : a = [ t ], e.__types__ = e.__types__ ? a.concat(e.__types__) : a;
}, a = function(e, t) {
    function a() {
        this.constructor = e;
    }
    for (var n in t) t.hasOwnProperty(n) && (e[n] = t[n]);
    a.prototype = t.prototype, e.prototype = new a();
}, n = function(t) {
    function n() {
        var e = t.call(this) || this;
        return e._w = 1334, e._h = 750, e.scoretype = "key20180827", wx.onMessage(function(t) {
            0 == t.type ? e.clearScore(t.score) : 1 == t.type ? e.saveScore(t.score) : 2 == t.type ? (e._selfOpenId = t.selfOpenId, 
            t.isDisplay ? e.cacheRankData ? (e.cancelGame(), e.runGame(e.cacheRankData)) : wx.getFriendCloudStorage({
                keyList: [ e.scoretype ],
                success: function(t) {
                    e.cacheRankData = t, e.cancelGame(), e.runGame(e.cacheRankData);
                },
                fail: function(e) {
                    console.log(e);
                },
                complete: function() {}
            }) : e.cancelGame()) : 3 == t.type ? (e._selfOpenId = t.selfOpenId, e._shareTicket = t.shareTicket, 
            e.cancelGame(), t.isDisplay ? wx.getGroupCloudStorage({
                shareTicket: e._shareTicket,
                keyList: [ e.scoretype ],
                success: function(t) {
                    e.cancelGame(), e.runGame(t);
                },
                fail: function(e) {
                    console.log(e);
                },
                complete: function() {}
            }) : e.cancelGame()) : 4 == t.type ? e.cacheRankData = null : 5 == t.type && (e._selfOpenId = t.selfOpenId, 
            t.isDisplay ? e.cacheRankData ? (e.cancelGame(), e.runGameSmall(e.cacheRankData)) : wx.getFriendCloudStorage({
                keyList: [ e.scoretype ],
                success: function(t) {
                    e.cacheRankData = t, e.cancelGame(), e.runGameSmall(e.cacheRankData);
                },
                fail: function(e) {
                    console.log(e);
                },
                complete: function() {}
            }) : e.cancelGame());
        }), wx.getUserCloudStorage({
            keyList: [ e.scoretype ],
            success: function(t) {
                t.KVDataList.forEach(function(t, a) {
                    console.log(t), t.key == e.scoretype && (e._myScore = t.value);
                });
            },
            fail: function(e) {
                console.log(e);
            },
            complete: function() {}
        }), e;
    }
    return a(n, t), n.prototype.runGameSmall = function(t) {
        var a = this;
        t.data = t.data.sort(function(e, t) {
            var n = 0;
            e.KVDataList.forEach(function(e, t) {
                e.key == a.scoretype && (n = Number(e.value));
            });
            var i = 0;
            return t.KVDataList.forEach(function(e, t) {
                e.key == a.scoretype && (i = Number(e.value));
            }), n != i ? i > n ? 1 : -1 : 0;
        });
        var n, i = 0;
        t.data.forEach(function(e, t) {
            e.openid == a._selfOpenId && (n = e, i = t);
        });
        var o = [];
        0 == i || 1 == i || 2 == i ? o = [ 0, 1, 2 ] : i >= 3 && (o = [ i - 2, i - 1, i ]);
        var r = 0;
        t.data.forEach(function(t, n) {
            if (-1 != o.indexOf(Number(n))) {
                var i = new e.DisplayObjectContainer();
                i.x = 170 + 210 * r + 172, i.y = 260, a.addChild(i), r++;
                var l = new e.TextField();
                l.x = 3, l.y = 16, l.width = 160, l.text = n + 1 + "", l.textAlign = e.HorizontalAlign.CENTER, 
                i.addChild(l), l.textColor = 1974874, l.$setSize(30), l.$setBold(!0);
                var c = new e.ImageLoader();
                c.addEventListener(e.Event.COMPLETE, function(t) {
                    var n = t.currentTarget;
                    a.bgtexture = new e.Texture(), a.bgtexture._setBitmapData(n.data);
                    var o = new e.Bitmap(a.bgtexture);
                    o.width = 120, o.height = 120, o.x = 26, o.y = 50, i.addChild(o);
                }, a), c.load(t.avatarUrl);
                var s = new e.TextField();
                s.x = -60, s.y = 179, s.width = 300, s.textAlign = e.HorizontalAlign.CENTER, s.text = a.getChar(t.nickname, 12), 
                i.addChild(s), s.textColor = 1974874, s.$setSize(30), s.$setBold(!0);
                var d = new e.TextField();
                d.x = -6, d.y = 218, d.width = 180, i.addChild(d), d.textColor = 1974874, d.$setSize(30), 
                d.$setBold(!0), d.textAlign = e.HorizontalAlign.CENTER, t.KVDataList.forEach(function(e, t) {
                    e.key == a.scoretype && (d.text = "" + e.value);
                });
            }
        }, this);
    }, n.prototype.saveScore = function(e) {
        var t = this;
        if (!(this._myScore >= e)) {
            var a = {
                KVDataList: [ {
                    key: this.scoretype,
                    value: e + ""
                } ],
                success: function(e) {
                    console.log("success", e);
                },
                fail: function(e) {
                    console.log("fail", e);
                },
                complete: function(a) {
                    console.log("complete", a), t._myScore = e;
                }
            };
            wx.setUserCloudStorage(a);
        }
    }, n.prototype.clearScore = function(e) {
        var t = this, a = {
            keyList: [ this.scoretype ],
            success: function(e) {
                console.log("success", e);
            },
            fail: function(e) {
                console.log("fail", e);
            },
            complete: function(a) {
                console.log("complete", a), t._myScore = e;
            }
        };
        wx.removeUserCloudStorage(a);
    }, n.prototype.runGame = function(t) {
        var a = this, n = this.stage.stageHeight - 600 >> 1, i = new e.DisplayObjectContainer();
        this.scrollView && this.scrollView.parent && (this.scrollView.parent.removeChild(this.scrollView), 
        this.scrollView = null), this.scrollView = new e.ScrollView(), this.scrollView.setContent(i), 
        this.scrollView.x = 265, this.scrollView.y = n + 70, this.scrollView.width = this._w, 
        this.scrollView.height = 502, this.scrollView.scrollTop = 0, this.addChild(this.scrollView), 
        t.data = t.data.sort(function(e, t) {
            var n = 0;
            e.KVDataList.forEach(function(e, t) {
                e.key == a.scoretype && (n = Number(e.value));
            });
            var i = 0;
            return t.KVDataList.forEach(function(e, t) {
                e.key == a.scoretype && (i = Number(e.value));
            }), n != i ? i > n ? 1 : -1 : 0;
        });
        var o, r = 0;
        t.data.forEach(function(t, n) {
            t.openId == a._selfOpenId && (o = t, r = n);
            var l = new e.DisplayObjectContainer();
            l.y = 70 * n, i.addChild(l);
            var c = new e.DisplayObjectContainer();
            l.addChild(c);
            var s = new e.ImageLoader();
            if (s.addEventListener(e.Event.COMPLETE, function(t) {
                var n = t.currentTarget;
                a.panel_01 = new e.Texture(), a.panel_01._setBitmapData(n.data);
                var i = new e.Bitmap(a.panel_01);
                i.width = 600, i.height = 60, i.x = 72, i.y = 0, c.addChild(i), i.alpha = .01;
            }, a), s.load("resource/assets/itembg.png"), n + 1 > 3) {
                var d = new e.TextField();
                d.x = 42, d.y = 18, d.width = 160, d.text = n + 1 + "", d.textAlign = e.HorizontalAlign.CENTER, 
                l.addChild(d), d.textColor = 16777215, d.$setSize(30);
            } else {
                var h = new e.ImageLoader();
                h.addEventListener(e.Event.COMPLETE, function(t) {
                    var n = t.currentTarget;
                    a.panel_01 = new e.Texture(), a.panel_01._setBitmapData(n.data);
                    var i = new e.Bitmap(a.panel_01);
                    i.width = 62, i.height = 60, i.x = 92, i.y = 2, c.addChild(i);
                }, a), h.load("resource/assets/rank" + (n + 1) + ".png");
            }
            var u = new e.ImageLoader();
            u.addEventListener(e.Event.COMPLETE, function(t) {
                var n = t.currentTarget;
                a.bgtexture = new e.Texture(), a.bgtexture._setBitmapData(n.data);
                var i = new e.Bitmap(a.bgtexture);
                i.width = 60, i.height = 60, i.x = 196, l.addChild(i);
            }, a), u.load(t.avatarUrl);
            var p = new e.TextField();
            p.x = 300, p.y = 18, p.text = a.getChar(t.nickname, 12), l.addChild(p), p.textColor = 16777215, 
            p.$setSize(30);
            var f = new e.TextField();
            f.x = 548, f.y = 18, f.width = 180, l.addChild(f), f.textColor = 16777215, f.$setSize(30), 
            f.$setTextAlign(e.HorizontalAlign.LEFT), t.KVDataList.forEach(function(e, t) {
                e.key == a.scoretype && (f.text = "" + e.value);
            });
        }, this);
    }, n.prototype.getChar = function(t, a) {
        var n = new e.ByteArray();
        return n.writeUTFBytes(t), n.length <= a ? t : (n.position = 0, n.readUTFBytes(a) + "...");
    }, n.prototype.cancelGame = function() {
        if (this._item) for (var e = 0, t = this._item.numChildren; t > e; e++) this._item.removeChildAt(0);
        for (var e = 0, t = this.numChildren; t > e; e++) this.removeChildAt(0);
        this.scrollView && this.scrollView.parent && (this.scrollView.parent.removeChild(this.scrollView), 
        this.scrollView = null), this._item = null;
    }, n;
}(e.DisplayObjectContainer);

t(n.prototype, "Main"), window.Main = n;